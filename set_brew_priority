#!/bin/bash

# Purpose: This script prioritizes /usr/local/bin in the PATH environment variable.
# It modifies ~/.bashrc to ensure /usr/local/bin is prepended to PATH for future
# shell sessions, and updates the current session's PATH if necessary.
# This is particularly useful for prioritizing locally installed tools (e.g., Homebrew)
# over system-wide versions. The script is idempotent and can be run multiple times safely.

# Function to update PATH in .bashrc
update_bashrc() {
    local bashrc_file="$HOME/.bashrc"
    local path_entry="/usr/local/bin"
    
    # Check if .bashrc exists, if not create it
    if [ ! -f "$bashrc_file" ]; then
        touch "$bashrc_file"
    fi
    
    # Check if PATH update already exists in .bashrc
    if grep -q "export PATH=\"$path_entry:\$PATH\"" "$bashrc_file"; then
        echo "PATH already updated in .bashrc"
    else
        echo -e "\n# Prepend /usr/local/bin to PATH" >> "$bashrc_file"
        echo "export PATH=\"$path_entry:\$PATH\"" >> "$bashrc_file"
        echo "Updated .bashrc with new PATH"
    fi
}

# Function to update current session's PATH
update_current_path() {
    if [[ ":$PATH:" != *":/usr/local/bin:"* ]]; then
        export PATH="/usr/local/bin:$PATH"
        echo "Updated current session's PATH"
    else
        echo "Current session's PATH already includes /usr/local/bin"
    fi
}

# Main execution
update_bashrc
update_current_path

echo "Script execution complete. Please run 'source ~/.bashrc' or start a new terminal session for changes to take effect."